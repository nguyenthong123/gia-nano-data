name: Update Data from Google Drive

# Cấu hình thời gian chạy
on:
  schedule:
    # Chạy tự động vào 23:30 giờ Việt Nam hàng ngày (16:30 UTC)
    - cron: '30 16 * * *'
  # Cho phép nhấn nút chạy thủ công để test
  workflow_dispatch:

permissions:
  contents: write

jobs:
  update-data:
    runs-on: ubuntu-latest
    
    steps:
      # 1. Tải code hiện tại của kho về máy ảo
      - name: Checkout repository
        uses: actions/checkout@v3

      # 2. Tạo thư mục data nếu chưa có
      - name: Create data directory
        run: mkdir -p data

      # 3. Tải các file JSON từ Google Drive về thư mục data
      - name: Download JSONs from Drive
        run: |
          # File 1: Bảng giá Nano Pima
          curl -L "https://drive.google.com/uc?export=download&id=1cnV5Z3t_EhYCff-DRwTD2MUuMlr51Ur8" -o data/gia_web_nano.json
          
          # File 2: Bảng giá Silicon Weber
          curl -L "https://drive.google.com/uc?export=download&id=1jO3hntZ2Oo2A4K6R57299U9mIBk80WyT" -o data/gia_silicon_weber.json

          # File 3: Dữ liệu khách hàng
          curl -L "https://drive.google.com/uc?export=download&id=1404085uVa15Hw10VGUp46b0zw0Rix35m" -o data/gia_khach_hang.json

          # File 4: Bảng giá Duraflex
          curl -L "https://drive.google.com/uc?export=download&id=1TSwe2cASzEBByFniu-YrMjLTGwz8WY4m" -o data/gia_duraflex.json

          # File 5: Chiết khấu Duraflex
          curl -L "https://drive.google.com/uc?export=download&id=12vy8tSc7D32IMz8JUKxIHVbNxa2llnBi" -o data/chiet_khau_duraflex.json

      # 4. Kiểm tra thay đổi và cam kết (Commit) lên GitHub
      run: |
          git config --global user.name "github-actions[bot]"
          git config --global user.email "github-actions[bot]@users.noreply.github.com"
          
          # Thêm tất cả file trong thư mục data
          git add data/
          
          # Commit nếu có thay đổi
          git commit -m "chore: Auto-update data files (Nano, Silicon, Customer, Duraflex) from Google Drive" || echo "No changes to commit"
          git push
