<!DOCTYPE html>
<html lang="vi">

<head>
	<!-- Google tag (gtag.js) -->
	<script async src="https://www.googletagmanager.com/gtag/js?id=G-QFQ2HMYTDH"></script>
	<script>
		window.dataLayer = window.dataLayer || [];
		function gtag() { dataLayer.push(arguments); }
		gtag('js', new Date());

		gtag('config', 'G-QFQ2HMYTDH');
	</script>

	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<title>Chi Tiết Sản Phẩm | Dunvex Digital</title>
	<link rel="icon" type="image/svg+xml"
		href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><rect width='100' height='100' rx='20' fill='%23FACC15'/><text x='50%' y='50%' dominant-baseline='central' text-anchor='middle' fill='white' font-size='60' font-family='sans-serif' font-weight='800'>DV</text></svg>">
	<link
		href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&family=Outfit:wght@600;800&display=swap"
		rel="stylesheet">
	<!-- Theme Consistency -->
	<script src="assets/theme-toggle.js"></script>
	<link rel="stylesheet" href="assets/theme.css">
	<style>
		* {
			margin: 0;
			padding: 0;
			box-sizing: border-box;
			font-family: 'Inter', -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
			text-rendering: optimizeLegibility;
			-webkit-font-smoothing: antialiased;
			-moz-osx-font-smoothing: grayscale;
			font-weight: 500;
		}

		body {
			background-color: var(--bg-body);
			color: var(--text-main);
			min-height: 100vh;
			display: flex;
			align-items: center;
			justify-content: center;
			padding: 20px;
			background-image: var(--bg-gradient-1), var(--bg-gradient-2);
			background-attachment: fixed;
			-webkit-text-size-adjust: 100%;
		}

		.detail-card {
			background: white;
			border: 1px solid var(--glass-border);
			border-radius: 32px;
			width: 100%;
			max-width: 850px;
			display: grid;
			grid-template-columns: 1fr 1.2fr;
			overflow: hidden;
			box-shadow: 0 15px 45px rgba(0, 0, 0, 0.07);
			animation: slideUp 0.6s cubic-bezier(0.16, 1, 0.3, 1);
		}

		@keyframes slideUp {
			from {
				opacity: 0;
				transform: translateY(40px);
			}

			to {
				opacity: 1;
				transform: translateY(0);
			}
		}

		@media (max-width: 768px) {
			.detail-card {
				grid-template-columns: 1fr;
			}
		}

		.product-image-side {
			background: #f8fafc;
			padding: 40px;
			display: flex;
			align-items: center;
			justify-content: center;
			position: relative;
			border-right: 1px solid #f1f5f9;
		}

		.product-image-side img {
			width: 100%;
			height: auto;
			max-height: 400px;
			object-fit: contain;
			border-radius: 20px;
			filter: drop-shadow(0 15px 30px rgba(0, 0, 0, 0.3));
		}

		.product-content-side {
			padding: 50px;
			display: flex;
			flex-direction: column;
		}

		.badge-cat {
			background: rgba(250, 204, 21, 0.15);
			color: #b45309;
			padding: 6px 16px;
			border-radius: 99px;
			font-size: 0.8rem;
			font-weight: 800;
			text-transform: uppercase;
			letter-spacing: 1px;
			width: fit-content;
			margin-bottom: 20px;
		}

		h1 {
			font-size: 2.8rem;
			font-weight: 800;
			margin-bottom: 8px;
			line-height: 1.1;
			color: #0f172a;
			letter-spacing: -1px;
		}

		.product-sku {
			color: #64748b;
			font-size: 1rem;
			margin-bottom: 25px;
			font-weight: 600;
		}

		.price-tag {
			font-size: 2.2rem;
			font-weight: 900;
			color: #1e293b;
			margin-bottom: 30px;
			letter-spacing: -0.5px;
		}

		.specs-grid {
			display: grid;
			grid-template-columns: 1fr 1fr;
			gap: 20px;
			margin-bottom: 40px;
		}

		.spec-item {
			display: flex;
			flex-direction: column;
			gap: 4px;
		}

		.spec-label {
			font-size: 0.75rem;
			color: #64748b;
			text-transform: uppercase;
			letter-spacing: 1px;
			font-weight: 800;
		}

		.spec-value {
			font-weight: 700;
			font-size: 1rem;
			color: #0f172a;
		}

		.tabs {
			margin-top: auto;
			border-top: 1px solid var(--glass-border);
			padding-top: 30px;
		}

		.tabs-header {
			display: flex;
			gap: 30px;
			margin-bottom: 15px;
		}

		.tab-btn {
			background: none;
			border: none;
			color: #64748b;
			font-weight: 800;
			cursor: pointer;
			padding-bottom: 10px;
			position: relative;
			transition: 0.3s;
			font-size: 1rem;
		}

		.tab-btn.active {
			color: #0f172a;
		}

		.tab-btn.active::after {
			content: '';
			position: absolute;
			bottom: 0;
			left: 0;
			width: 100%;
			height: 2px;
			background: var(--primary);
		}

		.tab-content {
			display: none;
			font-size: 0.95rem;
			color: #334155;
			line-height: 1.7;
			font-weight: 500;
		}

		.tab-content.active {
			display: block;
			animation: fadeIn 0.4s ease;
		}

		@keyframes fadeIn {
			from {
				opacity: 0;
			}

			to {
				opacity: 1;
			}
		}

		#errorMsg {
			text-align: center;
			padding: 40px;
			display: none;
			color: var(--text-muted);
		}
	</style>
</head>

<body>

	<div id="errorMsg">
		<h2>Sản phẩm không tồn tại hoặc đã bị xóa.</h2>
	</div>

	<div class="detail-card" id="content">
		<div class="product-image-side">
			<img src="" id="pImg" alt="Sản phẩm">
		</div>
		<div class="product-content-side">
			<div class="badge-cat" id="pCat">ĐANG TẢI...</div>
			<h1 id="pName">Tên sản phẩm</h1>
			<div class="product-sku" id="pId">Mã sản phẩm: --</div>

			<div class="price-tag" id="pPrice">0 đ</div>
			<div class="specs-grid">
				<div class="spec-item">
					<span class="spec-label">Quy cách</span>
					<span class="spec-value" id="pSpec">--</span>
				</div>
				<div class="spec-item">
					<span class="spec-label">Đóng kiện</span>
					<span class="spec-value" id="pPack">--</span>
				</div>
				<div class="spec-item">
					<span class="spec-label">Trọng lượng riêng</span>
					<span class="spec-value" id="pWeight">--</span>
				</div>
			</div>

			<div class="tabs">
				<div class="tabs-header">
					<button class="tab-btn active" onclick="switchTab(0)">Mô tả</button>
					<button class="tab-btn" onclick="switchTab(1)">Thông số</button>
				</div>
				<div class="tab-content active" id="tab0">
					Sản phẩm chất lượng cao, độ bền tốt, phù hợp cho các công trình xây dựng hiện đại. Thiết kế tối ưu
					cho việc lắp đặt nhanh chóng và bền bỉ dưới mọi thời tiết.
				</div>
				<div class="tab-content" id="tab1">
					Đang tải thông số chi tiết...
				</div>
			</div>
		</div>
	</div>

	<script>
		// Hàm chuyển đổi link Google Drive để hiển thị ảnh
		function convertDriveLink(url) {
			if (!url) return '';
			if (url.includes('drive.google.com')) {
				const id = url.split('/d/')[1]?.split('/')[0] || url.split('id=')[1]?.split('&')[0];
				return id ? `https://lh3.googleusercontent.com/d/${id}` : url;
			}
			return url;
		}

		function getParam(name) {
			return new URLSearchParams(window.location.search).get(name);
		}

		function switchTab(idx) {
			document.querySelectorAll('.tab-btn').forEach((b, i) => {
				b.classList.toggle('active', i === idx);
			});
			document.querySelectorAll('.tab-content').forEach((c, i) => {
				c.classList.toggle('active', i === idx);
			});
		}

		function formatPrice(val) {
			const n = parseFloat(val);
			return isNaN(n) ? '0' : n.toLocaleString('vi-VN');
		}

		function init() {
			const idFromUrl = getParam('id');
			const mode = getParam('mode');

			let p = null;

			// Priority 1: Direct Object passed from Parent (Reliable for ID collisions)
			if (mode === 'direct' || localStorage.getItem('direct_product_detail')) {
				try {
					const directStr = localStorage.getItem('direct_product_detail');
					if (directStr) p = JSON.parse(directStr);
				} catch (e) { console.warn('Error parsing direct detail', e); }
			}

			// Priority 2: Fallback to ID lookup from cache (Old method)
			if (!p) {
				const idFromStore = localStorage.getItem('last_selected_product_id');
				const id = idFromUrl || idFromStore;
				const all = JSON.parse(localStorage.getItem('last_loaded_products') || '[]');
				p = all.find(x => String(x.id_san_pham) == String(id));
			}

			if (!p) {
				document.getElementById('errorMsg').style.display = 'block';
				document.getElementById('content').style.display = 'none';
				return;
			}

			// Flexible Data Binding (Handle Sales vs Purchase keys)
			const pName = p.ten_san_pham || p.ten_vat_tu || 'Không có tên';
			const pId = p.id_san_pham || p.ma_vat_tu || '--';
			const pCat = p.ten_nghanh_hang || p.loai_vat_tu || 'Sản phẩm';
			const pPrice = p.gia_san_pham || p.gia_nhap || p.don_gia || 0;
			const pSpec = p.quy_cach || p.thong_so || 'Tiêu chuẩn';
			const pImage = p.image_san_pham || p.hinh_anh || '';

			// Cập nhật thông tin văn bản
			document.getElementById('pName').innerText = pName;
			document.getElementById('pId').innerText = "Mã sản phẩm: " + pId;
			document.getElementById('pCat').innerText = pCat;
			document.getElementById('pPrice').innerText = formatPrice(pPrice) + ' đ';
			document.getElementById('pSpec').innerText = pSpec;
			document.getElementById('pPack').innerText = p.dong_kien ? p.dong_kien + " tấm/kiện" : '--';
			document.getElementById('pWeight').innerText = p.trong_luong_rieng ? p.trong_luong_rieng + " kg" : '--';

			// Xử lý hình ảnh
			const finalImgUrl = convertDriveLink(pImage);
			document.getElementById('pImg').src = finalImgUrl || 'https://placehold.co/600x600/1e293b/white?text=No+Image';

			// Cập nhật tab kỹ thuật
			if (p.quy_cach || p.trong_luong_rieng || p.mo_ta) {
				let techInfo = `Thông số chi tiết: ${pSpec}.`;
				if (p.trong_luong_rieng) techInfo += ` Trọng lượng riêng: ${p.trong_luong_rieng} kg/đơn vị.`;
				if (p.mo_ta) techInfo += `\n\nMô tả: ${p.mo_ta}`;
				techInfo += ` Sản phẩm đạt chuẩn kiểm định xây dựng chất lượng cao.`;
				document.getElementById('tab1').innerText = techInfo;
			}
		}

		window.onload = init;
	</script>
	<script src="floating-menu.js"></script>
	<script src="chatbot.js"></script>
</body>

</html>